ekf_filter_node:
  ros__parameters:
    frequency: 30.0
    sensor_timeout: 0.1
    two_d_mode: true
    publish_tf: true
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link
    world_frame: odom
    
    # Print diagnostics
    print_diagnostics: true

    # Wheel odometry configuration
    odom0: /wheel/odom
    odom0_config: [true, true, false,  
                   false, false, true,  
                   true, false, false,  
                   false, false, true,  
                   false, false, false] 
    odom0_differential: false
    odom0_relative: false
    # Reduced covariance for more trust in wheel odometry
    odom0_pose_covariance_override: [0.5, 0.0, 0.0, 0.0, 0.0, 0.0,
                                     0.0, 0.5, 0.0, 0.0, 0.0, 0.0,
                                     0.0, 0.0, 1e6, 0.0, 0.0, 0.0,
                                     0.0, 0.0, 0.0, 1e6, 0.0, 0.0,
                                     0.0, 0.0, 0.0, 0.0, 1e6, 0.0,
                                     0.0, 0.0, 0.0, 0.0, 0.0, 0.5]  
    odom0_twist_covariance_override: [1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                      0.0, 5.0, 0.0, 0.0, 0.0, 0.0,
                                      0.0, 0.0, 1e6, 0.0, 0.0, 0.0,
                                      0.0, 0.0, 0.0, 1e6, 0.0, 0.0,
                                      0.0, 0.0, 0.0, 0.0, 1e6, 0.0,
                                      0.0, 0.0, 0.0, 0.0, 0.0, 0.05]  

    # IMU configuration - be more selective about what to use
    imu0: /imu/data_raw_1
    
    imu0_config: [false, false, false,   # pose x,y,z
                  false, false, true,    # roll,pitch,yaw -> only yaw
                  false, false, false,   # vx,vy,vz
                  false, false, true,    # vroll,vpitch,vyaw -> only yaw rate
                  false, false, false]
    imu0_differential: false
    imu0_remove_gravitational_acceleration: true  # Important for upside-down IMU
    
    # More conservative IMU covariances
    imu0_linear_acceleration_covariance_override: [1e6, 0.0, 0.0,
                                                   0.0, 1e6, 0.0,
                                                   0.0, 0.0, 1e6]  
    imu0_angular_velocity_covariance_override: [1e6, 0.0, 0.0,
                                                0.0, 1e6, 0.0,
                                                0.0, 0.0, 0.02]   
    # Process noise - describes how much the robot state can change between updates
    process_noise_covariance: [0.05, 0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.05, 0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.06, 0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.03, 0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.03, 0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.06, 0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.025, 0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.025, 0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.04, 0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.01, 0.0,    0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.01, 0.0,    0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.02, 0.0,    0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.01, 0.0,    0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.01, 0.0,
                                   0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.015]
